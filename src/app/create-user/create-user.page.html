<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/user-list"></ion-back-button>
    </ion-buttons>
    <ion-title>Crear Nuevo Usuario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-list>
    <ion-item>
      <ion-input label="Nombre Completo" labelPlacement="floating" [(ngModel)]="usuario.nombreCompleto" type="text" required></ion-input>
    </ion-item>
    <ion-item>
      <ion-input label="Correo Electrónico" labelPlacement="floating" [(ngModel)]="usuario.email" type="email" required></ion-input>
    </ion-item>
    <ion-item>
      <ion-input label="Contraseña" labelPlacement="floating" [(ngModel)]="usuario.password" type="password" required></ion-input>
    </ion-item>
    <ion-item>
      <ion-select label="Rol del Usuario" [(ngModel)]="usuario.rol">
        <ion-select-option value="estudiante">Estudiante</ion-select-option>
        <ion-select-option value="profesor">Profesor</ion-select-option>
        <ion-select-option value="administrador">Administrador</ion-select-option>
      </ion-select>
    </ion-item>
    <!-- Este campo solo se muestra si el rol es 'estudiante' -->
    <ion-item *ngIf="usuario.rol === 'estudiante'">
      <ion-select label="Grado del Estudiante" labelPlacement="floating" [(ngModel)]="usuario.gradoId" required>
        <!-- ** CORRECCIÓN AQUÍ **: Se usa grados$ con el pipe async -->
        <ion-select-option *ngFor="let grado of grados$ | async" [value]="grado.id">
          {{ grado.nombre }} - {{ grado.seccion }}
        </ion-select-option>
      </ion-select>
    </ion-item>
  </ion-list>

  <ion-button expand="block" (click)="crearUsuario()" [disabled]="guardando" class="ion-margin-top">
    <span *ngIf="!guardando">Crear Usuario</span>
    <ion-spinner *ngIf="guardando" name="crescent"></ion-spinner>
  </ion-button>
</ion-content>